<!--สิ่งที่ติดปัญหาอยู่และยังไม่ได้แก้ไข
  1.templat datatable ไม่สามารถดึงได้มาใช้งานได่้
  2.ส่วนของ "tooltip" เรียกใช่งานจาก bootstrap ไม่ได้ tooltip คือ เมื่อเอาเมาส์ไปที่ปุ่มแล้วมันจะขึ้นข้อความขึ้นมานะอย่าง "ดูรายละเอียด"
  3.style ของ tooltip ใช้ได้แค่ในตัวของ modal ถึงใช้ได้แต่ไม่สามารถมีการทำงานในแบบที่ต้องการได้ ตำแหน่งเริ่มต้นของ
-->
<div class="main-content">
  <div class="row justify-content-end">
    <div class="col-sm-2">
      <div class="insert-data">
        <button class="btn btn-success pull-center" (click)="openInsertModal()">
          <i class="fa fa-plus"></i> &nbsp;เพิ่มรายการ
        </button>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <!-- <div class="card-Edit"> -->
          <div style="display: flex; justify-content: space-between" class="card-header card-header-danger">
            <h4 class="card-title" style="text-align: center">
              การลงตรวจอิเล็กทรอนิค
            </h4>
            <p class="card-category"></p>
            <!-- <div class="btnBar">
              <form class="navbar-form">
      
              </form> -->
            <!-- (click)="searchData(myInputSearch.value)" -->
            <!-- </div> -->
          </div>

          <!-- </div> card-Edit -->

          <div class="card-body">
            <div class="table-responsive">
              <table width="100%" datatable [dtOptions]="dtOptions"
                class="table table-border table-hover table-bordered nowrap">
                <thead class="text-primary" style="color: #000;">
                  <tr>
                    <th style="width: 2%; white-space: nowrap; text-align: center; color: #000; ">ครั้งที่</th>
                    <th style="width: 2%; white-space: nowrap; text-align: center; color: #000; ">วันที่เริ่มตรวจสอบ
                    </th>
                    <th style="width: 2%; white-space: nowrap; text-align: center; color: #000; ">วันที่เสร็จสิ้น</th>
                    <th style="width: 2%; white-space: nowrap; text-align: center; color: #000; ">สถานที่</th>
                    <th style="color: #000; " class="text-center"><i class="fa fa-gear"></i></th>
                  </tr>
                </thead>
                <tbody>
                  <!---->
                  <tr *ngFor="let item of items?.records">


                    <td style=" text-align: center;">

                      {{item.record_id}}
                    </td>
                    <td style=" white-space: nowrap;">

                      {{item.record_star_date | thaidate: "medium"}}
                    </td>
                    <td style=" white-space: nowrap;">

                      {{item.record_end_date | thaidate: "medium"}}
                    </td>
                    <td style=" white-space: nowrap;">

                      <div class="ellipsis" [attr.title]="item.record_location" data-toggle="tooltip">
                        {{item.record_location}}
                      </div>
                    </td>

                    <td class=" text-center " style=" width:1% ;white-space: nowrap;">
                      <!-- <a href="" (click)="openModal()"><i class="fa fa-file-text-o" ></i></a>&nbsp; -->
                      <!-- <a href=""  (click)="onRecord()" ><i class="fa fa-pencil-square-o" ></i></a>&nbsp;
                      <a href=""><i class="fa fa-file-pdf-o" (click)="printPDF()" ></i></a> -->
                      <button (click)="openModal(item._id)" class="text-primary"
                        style="border: none; background: none;">
                        <i data-toggle="tooltip" title="ดูรายละเอียด" data-placement="top" class="fa fa-file-text-o "
                          style="color: black;"></i>
                      </button>&nbsp;


                      <button (click)="onRecord()" style="border: none; background: none;" class="text-primary">
                        <i data-toggle="tooltip" title="การจดบันทึก" data-placement="top" class="fa fa-pencil-square-o "
                          style="color: black;"></i>
                      </button> &nbsp;

                      <button style="border: none; background: none;">
                        <i class="fa fa-file-pdf-o " (click)="PDFshow()" style="color: black;"></i>
                        &nbsp;
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="pdf-viewer" *ngIf="showPDF">
              <ngx-extended-pdf-viewer [src]="'assets/example.pdf'" useBrowserLocale="true"></ngx-extended-pdf-viewer>
            </div>
          </div>

          <!-- การเพิ่มข้อมูล
            <div class="modal fade" id="insertModel" tabindex="-1" role="dialog"
                aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header"
                            style="background: rgb(255,209,0);">
                            <h5 class="modal-title"
                                id="myModalLabel">เพิ่มรายการ</h5>
                            <button type="button" class="close"
                                data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body"
                            [ngStyle]="{'width': '20px', 'height': '210mm'}">
                          
                            <form action method="post">
                                <button
                                            (click)="addPersonModel()"
                                            style="border: 1px solid black; background: none;"><i
                                                class="fa fa-plus"></i></button>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button"
                                class="btn btn-success pull-center"
                                (click)="detailCommit()"><i
                                    class="fa fa-check"></i>&nbsp;
                                ยืนยัน</button>
                            <button type="button" class="btn btn-danger"
                                data-dismiss="modal"><i
                                    class="fa fa-times"></i>&nbsp; ปิด</button>
                        </div>
                    </div>
                </div>
            </div>
        -->
          <!--land insert-->
          <div class="modal fade" id="insertModel" tabindex="-1" role="dialog" aria-labelledby="addItemModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header" class="card-header card-header-danger">

                  <div class="row">
                    <div class="col-sm">
                      <h5 class="modal-title" id="addItemModalLabel" style="color: white;">เพิ่มรายการ</h5>
                    </div>
                    <div class="col-sm">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="modal-body">
                  <form [formGroup]="addItemForm" (ngSubmit)="onInsertSummit(addItemForm.value)">
                    <div class="row">
                      <div class="col-sm-2">
                        <div class="form-group">
                          <label for="id" class="form-label">ครั้งที่:</label>
                          <input type="id" id="id" formControlName="id" class="form-control" placeholder="ครั้งที่" />
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="form-group">
                          <label for="startDate">วันที่เริ่มตรวจสอบ</label>
                          <input style="color:rgb(171, 171, 171)" type="date" id="startDate" formControlName="startDate"
                            class="form-control" placeholder="วันที่เริ่มตรวจสอบ" />
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label for="endDate">วันที่เสร็จสิ้น</label>
                          <input style="color:rgb(171, 171, 171)" type="date" id="endDate" formControlName="endDate"
                            class="form-control" placeholder="วันที่เสร็จสิ้น" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm">
                        <div class="form-group">
                          <label for="topic">หัวข้อการตรวจสอบ</label>
                          <input type="text" id="topic" formControlName="topic" class="form-control"
                            placeholder="หัวข้อการตรวจสอบ" />
                        </div>
                      </div>
                    </div>

                    <!-- <form action method="post" [formGroup]="addPersonalForm"> -->
                    <div class="row inputLabel">
                      <div class="col-sm-3">
                        <label for="rank">ยศ/ตำแหน่ง</label>
                      </div>
                      <div class="col-sm-5">
                        <label for="fullname">ชื่อ-นามสกุล</label>
                      </div>
                      <div class="col-md-2">
                        <button type="button" (click)="addPersonInput()" style="border: none; background: none;">
                          <i class="fa fa-plus"></i>
                        </button>
                        <button type="button" (click)="deletePersonInput()" style="border: none; background: none;">
                          <i class="fa fa-minus"></i>
                        </button>

                      </div>

                    </div>
                    <!-- formArrayName="personal" -->
                    <div>
                      <div *ngFor="let person of addItemForm.get('personal')['controls']; let i = index"
                        [formGroup]="addItemForm">
                        <div class="row mx-0" [formGroup]="person">
                          <div class="col-sm-3">
                            <div class="form-group">

                              <input type="text" id="rank-{{i}}" formControlName="rank" class="form-control"
                                placeholder="ยศ/ตำแหน่ง" />
                            </div>
                          </div>
                          <div class="col-sm-5">
                            <div class="form-group">

                              <input type="text" id="fullname-{{i}}" formControlName="fullname" class="form-control"
                                placeholder="--กรอกข้อมูล--" />
                            </div>

                          </div>

                        </div>

                      </div>

                    </div>
                    <!-- </form> -->
                    <!-- <form action method="post" [formGroup]="addPersonalForm">
                    </form> -->

                    <div class="form-group">
                      <label for="detail">รายละเอียด</label>
                      <input type="text" id="detail" formControlName="detail" class="form-control"
                        placeholder="รายละเอียด" />
                    </div>
                    <div class="form-group">
                      <label for="location">สถานที่</label>
                      <input type="text" id="location" formControlName="location" class="form-control"
                        placeholder="สถานที่" readonly>
                    </div>
                    <button type="button" class="btn btn-info" style="background: blue;" (click)="getCurrentLocation()">
                      <i class="fa fa-location-dot">&nbsp;</i>เลือก location
                      ปัจจุบัน</button>



                    <div class="modal-footer">
                      <button type="submit" class="btn btn-success"><i class="fa fa-check"></i>&nbsp;บันทึก</button>
                      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"
                          (click)="closeModal()"></i>
                        &nbsp; ปิด
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--land Insert end here-->
          <!-- รายละเอียด-->
          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content" [ngStyle]="{ width: '230mm', height: '327mm' }">
                <div class="modal-header card-header card-header-danger" style="background: rgb(255, 209, 0)">
                  <h5 class="modal-title" id="myModalLabel" style="color: white;">รายละเอียด</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div id="myDetail" class="modal-body-detail" [ngStyle]="{ width: '210mm', height: '297mm' }">
                  <!-- เนื้อหาของป๊อปอัพ -->
                  <form action method="get">
                    <div class="mainCenter-panel "> <!---->
                      <div class="header-topic">

                        <label style="font-size: 16px; font-weight: bold;">เอกสารตรวจสอบ</label>
                        <p>{{ detailItems?.record_topic }}</p>

                      </div>

                      <div class="detail-content">
                        <div class="date-flex">
                          <div class="form-group start-date">
                            <label>วันที่เริ่มการตรวจสอบ:</label>
                            <p>{{ detailItems?.record_star_date | thaidate: 'medium' }}</p>
                          </div>
                          <div class="form-group end-date">
                            <label>วันที่เสร็จสิ้นการตรวจสอบ:</label>
                            <p>{{ detailItems?.record_end_date | thaidate: 'medium' }}</p>
                          </div>
                        </div>


                        <div class="form-group">
                          <label>รายละเอียด:</label>
                          <p>{{ detailItems?.record_detail }}</p>
                        </div>
                        <div class="form-group">
                          <label>สถานที่</label>
                          <p>{{ detailItems?.record_location }}</p>
                        </div>
                      </div>
                      <table class="main-detail">
                        <thead>
                          <tr>
                            <th>ครั้งที่</th>
                            <th>เนื้อหาการตรวจสอบ</th>
                          </tr>

                        </thead>
                        <tbody>
                          <tr>
                            <td>{{detailItems?.record_id}}/{{detailItems?.record_star_date | thaidate :'year'}}</td>
                            <!-- <td [innerHTML]="typroText"></td> -->
                            <td> {{typroText}} </td>
                          </tr>
                        </tbody>
                      </table>


                      <div class="sign-content">
                        <div class="form-group">
                          <label>รายชื่อผู้รับผิดชอบ:</label>
                          <div *ngFor="let person of viewData; let i = index">
                            <div class="UploadContentBox">
                              <!-- <div>
                                <i class="fa fa-upload" style="font-size:24px; cursor: pointer;"
                                  (click)="uploadImage(i)" *ngIf="!isLoading[i] && !uploadedImages[i]"></i>
                                <input type="file" id="image-upload-{{i}}" (change)="onFileChange($event, i)"
                                  accept="image/" style="display: none;">
                                <img [src]="uploadedImages[i]" alt="Uploaded Image" *ngIf="uploadedImages[i]"
                                  style="max-width: 100px; max-height: 100px; display: block; margin-top: 10px;">
                              </div> -->
                              <div class="openSignModal" (click)="openSignModal(i)">
                                <a>คลิกเพื่อเซ็น</a>
                                
                              </div>
                              <!-- Sign modal -->
                              <div class="Writte-sign" #writteSignElement id="SignModal-{{i}}"
                                *ngIf="isSignModalVisible[i]">
                                <canvas id="writteSignCanvas-{{i}}" class="full-page-signWritte">Error someting with
                                  canvas</canvas>
                                <button (click)="refreshSignCanvas(i)" style="border: none; background: none;">
                                  <i data-toggle="tooltip" title="ลบ" data-placement="top"
                                    class="fa fa-refresh"></i></button>
                              </div>
                            </div>
                            <a>( {{ person.view_rank }} &nbsp; &nbsp; {{ person.view_full_name }} )</a>
                          </div>
                        </div>
                      </div>


                    </div>
                  </form>
                  <!-- <div class="right-panel">
                    <form action="">
                      <div class="right-panelOnTop">
                  
                      </div>

                     


                    </form>
                  </div> -->
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-success pull-center" (click)="printPDF()">
                    <i class="fa fa-download"></i>&nbsp; ดาว์โหลด
                  </button>
                  <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="closeModal()">
                    <i class="fa fa-times"></i>&nbsp; ปิด
                  </button>
                </div>
              </div>
            </div>
          </div>


          <!--[formGroup]="Form" (ngSubmit)="addPersonCommit(Form.value)" modal อันที่เป็นของ add person หน้าเล็กๆๆ ถูกลบออกนะ-->


          <!-- จดบันทึก-->
          <div class="modal fade" id="writtenModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content" [ngStyle]="{ width: '230mm' }">
                <div class="modal-header card-header card-header-danger" style="background: rgb(255, 209, 0)">
                  <h5 style="color: white;" class="modal-title" id="myModalLabel">จดบันทึก</h5>


                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="container">
                  <div class="row">
                    <div class="col-sm-2" style="padding-top: 20px;">
                      <div class="section">
                        &nbsp;
                        <button class="btn btn-just-icon" [ngClass]="{'active': activeButton === 'typro'}"
                          (click)="setActive('typro')"><!-- data-toggle="tooltip" title="การพิมพ์ข้อความ" data-placement="top" -->
                          <i class="fa fa-file-word-o"></i>
                        </button>
                        &nbsp;
                        <button class="btn btn-just-icon" [ngClass]="{'active': activeButton === 'writte'}"
                          (click)="setActive('writte')"><!--data-toggle="tooltip" title="การเขียน" data-placement="top"-->
                          <i class="fa fa-pencil-square-o"></i>
                        </button>
                      </div>
                    </div>
                    <div class="col-md-12" class="modal-body" style="width: 210mm; padding: 0 20px 0 20px;"
                      [ngStyle]="{top:0 }">

                      <div *ngIf="isTyproActive" class="full-page-textarea-container">
                        <div class="typroTextBox">
                          <div class="headerText">
                            <button aria-label="Preview">การพิมพ์ข้อความ</button>

                          </div>
                          <textarea contenteditable="true" [formGroup]="addItemForm"
                            (ngSubmit)="onInsertSummit(addNoteForm.value)"
                            class="form-control  full-page-textarea"></textarea>

                        </div>
                      </div>
                      <div *ngIf="isWritteActive" class="full-page-pdf">
                        <div class="writteDraw">
                          <div class="toolbar">
                            <button (click)="refreshCanvas()">
                              <i data-toggle="tooltip" title="การจดบันทึก" data-placement="top"
                                class="fa fa-refresh"></i></button>
                          </div>
                          <canvas id="writteCanvas" class="full-page-canvas"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="modal-footer">
                  <button type="submit" class="btn btn-success pull-center" (click)="recordCommit()">
                    <i class="fa fa-check"></i>&nbsp; ยืนยัน
                  </button>
                  <button type="button" class="btn btn-danger pull-center" data-dismiss="modal" (click)="closeModal()">
                    <i class="fa fa-times"></i>&nbsp; ปิด
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    </div>
   