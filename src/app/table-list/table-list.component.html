<!--สิ่งที่ติดปัญหาอยู่และยังไม่ได้แก้ไข
  1.templat datatable ไม่สามารถดึงได้มาใช้งานได่้
  2.ยังไม่ได้เชื่อมค่อกับระบบฐานข้อมูล
  3.ยังไม่ได้สร้าง services
  4.ยังไม่ได้ดึง ข้อมูลมาแสดงผล
  5.ยังไม่ได้สร้าง ระบบ เขียน และการมีคำสั่งของ pdf
  6.การพิมพ์ยังไม่ได้ทำเพิ่มได้แต่แบบที่เห็น
  7.ส่วนของ "tooltip" เรียกใช่งานจาก bootstrap ไม่ได้ tooltip คือ เมื่อเอาเมาส์ไปที่ปุ่มแล้วมันจะขึ้นข้อความขึ้นมานะอย่าง "ดูรายละเอียด"
-->

<div class="main-content">
  <div class="row justify-content-end">
    <div class="col-sm-2">
      <div class="insert-data">
        <button class="btn btn-danger pull-center" (click)="onInsert()">
          <i class="fa fa-plus"></i> &nbsp;เพิ่มรายการ
        </button>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <!-- <div class="card-Edit"> -->
          <div style="display: flex; justify-content: space-between" class="card-header card-header-danger">
            <h4 class="card-title" style="text-align: center">
              การลงตรวจอิเล็กทรอนิค
            </h4>
            <p class="card-category"></p>
            <!-- <div class="btnBar">
              <form class="navbar-form">
                <span class="bmd-form-group">
                  <div class="input-group no-border">
                    <input type="text" value class="form-control" placeholder="Search..." />
                    <button mat-raised-button type="submit" class="btn btn-white btn-round btn-just-icon">
                      <i class="material-icons">search</i>
                      <div class="ripple-container"></div>
                    </button>
                  </div>
                </span>
              </form> -->
            <!-- (click)="searchData(myInputSearch.value)" -->
            <!-- </div> -->
          </div>

          <!-- </div> card-Edit -->
          <div class="card-body">
            <div class="table-responsive">
              <table width="100%" datatable [dtOptions]="dtOptions"
                class="table table-border table-hover table-bordered nowrap">
                <thead class="text-primary">
                  <tr>
                    <th>ครั้งที่</th>
                    <th>วันที่เริ่มตรวจสอบ</th>
                    <th>วันที่เสร็จสิ้น</th>
                    <th>สถานที่</th>
                    <th class="text-center"><i class="fa fa-gear"></i></th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of items?.records">
                  <!---->
                  <tr>
                    <!-- ข้อมูลที่จะดึงจาก services มาใส่ใน tbody นี้นะมีแบบให้แห้แหละ -->

                    <td>

                      {{item.record_id}}
                    </td>
                    <td>

                      {{item.record_star_date | thaidate: "medium"}}
                    </td>
                    <td>

                      {{item.record_end_date | thaidate: "medium"}}
                    </td>
                    <td>

                      {{item.record_location}}
                    </td>

                    <td class=" text-center " style="width: 1%; white-space: nowrap;">
                      <!-- <a href="" (click)="openModal()"><i class="fa fa-file-text-o" ></i></a>&nbsp; -->
                      <!-- <a href=""  (click)="onRecord()" ><i class="fa fa-pencil-square-o" ></i></a>&nbsp;
                      <a href=""><i class="fa fa-file-pdf-o" (click)="printPDF()" ></i></a> -->
                      <button (click)="openModal(item._id)" class="text-primary"
                        style="border: none; background: none;">
                        <i class="fa fa-file-text-o  text-primary" style="color: black;"></i>
                      </button>&nbsp;


                      <button (click)="onRecord()" style="border: none; background: none;" class="text-primary">
                        <i class="fa fa-pencil-square-o  text-primary" style="color: black;"></i>
                      </button> &nbsp;

                      <button style="border: none; background: none;">
                        <i class="fa fa-file-pdf-o text-primary" (click)="printPDF()" style="color: black;"></i>
                        &nbsp;
                      </button>
                    </td>
                  </tr>
                </tbody>

              </table>
            </div>
          </div>

          <!-- การเพิ่มข้อมูล
            <div class="modal fade" id="insertModel" tabindex="-1" role="dialog"
                aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header"
                            style="background: rgb(255,209,0);">
                            <h5 class="modal-title"
                                id="myModalLabel">เพิ่มรายการ</h5>
                            <button type="button" class="close"
                                data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body"
                            [ngStyle]="{'width': '20px', 'height': '210mm'}">
                          
                            <form action method="post">
                                <button
                                            (click)="addPersonModel()"
                                            style="border: 1px solid black; background: none;"><i
                                                class="fa fa-plus"></i></button>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button"
                                class="btn btn-success pull-center"
                                (click)="detailCommit()"><i
                                    class="fa fa-check"></i>&nbsp;
                                ยืนยัน</button>
                            <button type="button" class="btn btn-danger"
                                data-dismiss="modal"><i
                                    class="fa fa-times"></i>&nbsp; ปิด</button>
                        </div>
                    </div>
                </div>
            </div>
        -->
          <!--land insert-->
          <div class="modal fade" id="insertModel" tabindex="-1" role="dialog" aria-labelledby="addItemModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header" class="card-header card-header-danger">

                  <div class="row">
                    <div class="col-sm">
                      <h5 class="modal-title" id="addItemModalLabel" style="color: white;">เพิ่มรายการ</h5>
                    </div>
                    <div class="col-sm">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                  </div>

                </div>
                <div class="modal-body">
                  <form [formGroup]="addItemForm" (ngSubmit)="onInsertSummit(addItemForm.value)">
                    <div class="row">
                      <div class="col-sm-2">
                        <div class="form-group">
                          <label for="id" class="form-label">ครั้งที่:</label>

                          <input type="id" id="Date" formControlName="id" class="form-control" placeholder="ครั้งที่" />
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="form-group">
                          <label for="startDate">วันที่เริ่มตรวจสอบ</label>
                          <input style="color:rgb(171, 171, 171)" type="date" id="startDate" formControlName="startDate"
                            class="form-control" placeholder="วันที่เริ่มตรวจสอบ" />
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label for="endDate">วันที่เสร็จสิ้น</label>
                          <input style="color:rgb(171, 171, 171)" type="date" id="endDate" formControlName="endDate"
                            class="form-control" placeholder="วันที่เสร็จสิ้น" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm">
                        <div class="form-group">
                          <label for="topic">งานที่ตรวจ</label>
                          <input type="text" id="topic" formControlName="topic" class="form-control"
                            placeholder="งานที่ตรวจ" />
                        </div>
                      </div>
                    </div>

                    <!-- <form action method="post" [formGroup]="addPersonalForm"> -->
                    <div class="row inputLabel">
                      <div class="col-sm-3">
                        <label for="rank">ยศ/ตำแหน่ง</label>
                      </div>
                      <div class="col-sm-5">
                        <label for="fullname">ชื่อ-นามสกุล</label>
                      </div>
                      <div class="col-md-2">
                        <button type="button" (click)="addPersonInput()" style="border: none; background: none;">
                          <i class="fa fa-plus"></i>
                        </button>
                      </div>

                    </div>
                    <!-- formArrayName="personal" -->
                    <div>
                      <div *ngFor="let person of addItemForm.get('personal')['controls']; let i = index"
                        [formGroup]="addItemForm">
                        <div class="row mx-0" [formGroup]="person">
                          <div class="col-sm-3">
                            <div class="form-group">

                              <input type="text" id="rank-{{i}}" formControlName="rank" class="form-control"
                                placeholder="ยศ/ตำแหน่ง" />
                            </div>
                          </div>
                          <div class="col-sm-5">
                            <div class="form-group">

                              <input type="text" id="fullname-{{i}}" formControlName="fullname" class="form-control"
                                placeholder="--กรอกข้อมูล--" />
                            </div>
                          </div>
                        </div>

                      </div>

                    </div>
                    <!-- </form> -->
                    <!-- <form action method="post" [formGroup]="addPersonalForm">
                      <div class="row">

                        <div class="col-sm-3">
                          <div class="form-group">
                            <label for="rank">ยศ/ตำเเหน่ง</label>
                            <input type="text" id="rank" formControlName="rank" class="form-control"
                              placeholder="ยศ/ตำเเหน่ง" />
                            <div *ngFor="let input of personInputs">
                              <input type="text" id="rank" formControlName="rank" class="form-control"
                                placeholder="ยศ/ตำเเหน่ง" />
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-5">
                          <div class="form-group">
                            <label for="fullname">ชื่อ-นามสกุล</label>
                            <input type="text" id="fullname" formControlName="fullname" class="form-control"
                              placeholder="--กรอกข้อมูล--" />
                            <div *ngFor="let input of personInputs">
                              <input type="text" id="fullname" formControlName="fullname" class="form-control"
                                placeholder="--กรอกข้อมูล--" />
                            </div>



                          </div>
                        </div>
                        <div class="col-md-2">
                          <button (click)="addPersonInput()" style="border: none; background: none;"><i
                              class="fa fa-plus"></i></button>
                        </div>


                      </div>
                    </form> -->

                    <div class="form-group">
                      <label for="detail">รายละเอียด</label>
                      <input type="text" id="detail" formControlName="detail" class="form-control"
                        placeholder="รายละเอียด" />
                    </div>
                    <div class="form-group">
                      <label for="location">สถานที่</label>
                      <input type="text" id="location" formControlName="location" class="form-control"
                        placeholder="สถานที่" readonly>
                    </div>
                    <button type="button" class="btn btn-primary" (click)="getCurrentLocation()">เลือก location
                      ปัจจุบัน</button>
                      
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-success"><i class="fa fa-check"></i>บันทึก</button>
                      <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i>
                        ปิด
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--land Insert end here-->
          <!-- รายละเอียด-->
          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header card-header card-header-danger" style="background: rgb(255, 209, 0)">
                  <h5 class="modal-title" id="myModalLabel" style="color: white;">รายละเอียด</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div id="myDetail" class="modal-body-detail" [ngStyle]="{ width: '210mm', height: '297mm' }">
                  <!-- เนื้อหาของป๊อปอัพ -->
                  <form action method="get">
                    <div class="mainCenter-panel "> <!---->
                      <div class="header-topic">

                        <label style="font-size: 16px; font-weight: bold;">เอกสารตรวจสอบ</label>
                        <p>{{ detailItems?.record_topic }}</p>

                      </div>
                      <div class="detail-content">
                        <div class="date-flex">
                          <div class="form-group start-date">
                            <label>วันที่เริ่มการตรวจสอบ:</label>
                            <p>{{ detailItems?.record_star_date | thaidate: 'medium' }}</p>
                          </div>
                          <div class="form-group end-date">
                            <label>วันที่เสร็จสิ้นการตรวจสอบ:</label>
                            <p>{{ detailItems?.record_end_date | thaidate: 'medium' }}</p>
                          </div>
                        </div>


                        <div class="form-group">
                          <label>รายละเอียด:</label>
                          <p>{{ detailItems?.record_detail }}</p>
                        </div>
                        <div class="form-group">
                          <label>สถานที่</label>
                          <p>{{ detailItems?.record_location }}</p>
                        </div>
                      </div>
                      <table class="main-detail">
                        <thead>
                          <tr>
                            <th>ครั้งที่</th>
                            <th>เนื้อหาการตรวจสอบ</th>
                          </tr>

                        </thead>
                        <tbody>
                          <tr>
                            <td>{{detailItems?.record_id}}/{{detailItems?.record_star_date | thaidate :'year'}}</td>
                            <td>{{typroText}}</td>
                          </tr>
                        </tbody>
                      </table>

                      <div class="sign-content">
                        <div class="form-group">
                          <label>รายชื่อผู้รับผิดชอบ:</label>
                          <div *ngFor="let person of viewData; let i = index">
                            <div>
                              <div>
                                <i class="fa fa-upload" style="font-size:24px; cursor: pointer;" 
                                   (click)="uploadImage(i)" *ngIf="!isLoading[i] && !uploadedImages[i]"></i>
                                <input type="file" id="image-upload-{{i}}" (change)="onFileChange($event, i)" accept="image/*" style="display: none;">
                                <img [src]="uploadedImages[i]" alt="Uploaded Image" *ngIf="uploadedImages[i]" 
                                     style="max-width: 100px; max-height: 100px; display: block; margin-top: 10px;">
                              </div>
                            </div>
                      
                            <p>{{ person.view_rank }} &nbsp; &nbsp; {{ person.view_full_name }}</p>
                          </div>
                        </div>
                      </div>
0
                </div>
                </form>
                <!-- <div class="right-panel">
                    <form action="">
                      <div class="right-panelOnTop">
                  
                      </div>

                     


                    </form>
                  </div> -->
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-success pull-center" (click)="printPDF()">
                  <i class="fa fa-check" data-toggle="tooltip" title="dowload to PDF"></i>&nbsp; ดาว์โหลด
                </button>
                <button type="button" class="btn btn-danger" (click)="closeModal()">
                  <i class="fa fa-times"></i>&nbsp; ปิด
                </button>
              </div>
            </div>
          </div>
        </div>
        <!--[formGroup]="Form" (ngSubmit)="addPersonCommit(Form.value)" modal อันที่เป็นของ add person หน้าเล็กๆๆ ถูกลบออกนะ-->

        <!-- จดบันทึก-->
        <div class="modal fade" id="writtenModel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
          aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header card-header card-header-danger" style="background: rgb(255, 209, 0)">
                <h5 style="color: white;" class="modal-title" id="myModalLabel">จดบันทึก</h5>


                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="container">
                <div class="row">
                  <div class="col-sm">
                    <div class="section">
                      &nbsp;
                      <button class="btn btn-just-icon" [ngClass]="{'active': activeButton === 'typro'}"
                        (click)="setActive('typro')">
                        <i class="fa fa-file-word-o"></i>
                      </button>
                      &nbsp;
                      <button class="btn btn-just-icon" [ngClass]="{'active': activeButton === 'writte'}"
                        (click)="setActive('writte')">
                        <i class="fa fa-pencil-square-o"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-12" class="modal-body" style="width: 210mm; height: 297mm"
                    [ngStyle]="{ height: '210mm' }">

                    <div *ngIf="isTyproActive" class="full-page-textarea-container">



                      <textarea [(ngModel)]="typroText" placeholder="พิมพ์ที่นี้.."
                        class="form-control mt-3 full-page-textarea"></textarea>

                    </div>
                    <div *ngIf="isWritteActive" class="full-page-pdf">
                      <a> writte section</a>

                    </div>


                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-success pull-center" (click)="recordCommit()">
                  <i class="fa fa-check"></i>&nbsp; ยืนยัน
                </button>
                <button type="button" class="btn btn-danger pull-center" data-dismiss="modal">
                  <i class="fa fa-times"></i>&nbsp; ปิด
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


  </div>
  <!-- 
    <div class="main-content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header card-header-danger">
                <h4 class="card-title">Simple Table</h4>
                <p class="card-category">Here is a subtitle for this table</p>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table">
                    <thead class="text-primary">
                      <th>ID</th>
                      <th>Name</th>
                      <th>Country</th>
                      <th>City</th>
                      <th>Salary</th>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td>Dakota Rice</td>
                        <td>Niger</td>
                        <td>Oud-Turnhout</td>
                        <td class="text-primary">$36,738</td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>Minerva Hooper</td>
                        <td>Curaçao</td>
                        <td>Sinaai-Waas</td>
                        <td class="text-primary">$23,789</td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>Sage Rodriguez</td>
                        <td>Netherlands</td>
                        <td>Baileux</td>
                        <td class="text-primary">$56,142</td>
                      </tr>
                      <tr>
                        <td>4</td>
                        <td>Philip Chaney</td>
                        <td>Korea, South</td>
                        <td>Overland Park</td>
                        <td class="text-primary">$38,735</td>
                      </tr>
                      <tr>
                        <td>5</td>
                        <td>Doris Greene</td>
                        <td>Malawi</td>
                        <td>Feldkirchen in Kärnten</td>
                        <td class="text-primary">$63,542</td>
                      </tr>
                      <tr>
                        <td>6</td>
                        <td>Mason Porter</td>
                        <td>Chile</td>
                        <td>Gloucester</td>
                        <td class="text-primary">$78,615</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <div class="card card-plain">
              <div class="card-header card-header-danger">
                <h4 class="card-title mt-0">Table on Plain Background</h4>
                <p class="card-category">Here is a subtitle for this table</p>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead class>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Country</th>
                      <th>City</th>
                      <th>Salary</th>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td>Dakota Rice</td>
                        <td>Niger</td>
                        <td>Oud-Turnhout</td>
                        <td>$36,738</td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>Minerva Hooper</td>
                        <td>Curaçao</td>
                        <td>Sinaai-Waas</td>
                        <td>$23,789</td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>Sage Rodriguez</td>
                        <td>Netherlands</td>
                        <td>Baileux</td>
                        <td>$56,142</td>
                      </tr>
                      <tr>
                        <td>4</td>
                        <td>Philip Chaney</td>
                        <td>Korea, South</td>
                        <td>Overland Park</td>
                        <td>$38,735</td>
                      </tr>
                      <tr>
                        <td>5</td>
                        <td>Doris Greene</td>
                        <td>Malawi</td>
                        <td>Feldkirchen in Kärnten</td>
                        <td>$63,542</td>
                      </tr>
                      <tr>
                        <td>6</td>
                        <td>Mason Porter</td>
                        <td>Chile</td>
                        <td>Gloucester</td>
                        <td>$78,615</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>x
            </div>
          </div>
        </div>
      </div>
    </div> -->